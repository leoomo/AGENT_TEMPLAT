# Agent å·¥ä½œæµæŒ‡ä»¤ï¼ˆç²¾ç®€ç‰ˆ v2ï¼‰

> **Context é¢„ç®—ä¼˜åŒ–**: æ ¸å¿ƒæŒ‡ä»¤ ~2000 tokensï¼Œè¯¦ç»†é€»è¾‘é€šè¿‡è„šæœ¬æ‰§è¡Œ

---

## å·¥ä½œæµ

æ¯ä¸ª agent session ä¸¥æ ¼æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š

### Step 0: åˆå§‹åŒ–ï¼ˆé¦–æ¬¡ï¼‰

è‹¥ `task.json` ä¸å­˜åœ¨ï¼Œæ‰§è¡Œåˆå§‹åŒ–ï¼š

```bash
bash scripts/init-project.sh
```

ç„¶åç¼–è¾‘ `task.json` å®šä¹‰ä»»åŠ¡ã€‚

### Step 1: ç¯å¢ƒéªŒè¯

```bash
bash scripts/validate-env.sh
```

éªŒè¯é€šè¿‡åå†ç»§ç»­ã€‚å¦‚æœ‰å¤±è´¥é¡¹ï¼Œä¿®å¤åé‡æ–°éªŒè¯ã€‚

### Step 2: é€‰æ‹©ä»»åŠ¡

1. è¯»å– `task.json`
2. é€‰æ‹©æ¡ä»¶ï¼š
   - `passes: false`
   - `depends_on` ä¸­çš„ä»»åŠ¡å…¨éƒ¨ `passes: true`
3. ä¼˜å…ˆçº§ï¼š`priority` å€¼æœ€å°ï¼ˆ1 = æœ€é«˜ï¼‰
4. åŒçº§é€‰ `id` æœ€å°

**æ¯ä¸ª session åªåšä¸€ä¸ªä»»åŠ¡ã€‚**

### Step 3: å®ç°

- æŒ‰ `steps[]` é€æ­¥æ‰§è¡Œ
- æ›´æ–°æ–­ç‚¹ï¼š`.agent/checkpoint.json`
- éµå¾ªé¡¹ç›®ä»£ç é£æ ¼

### Step 4: éªŒè¯

**åŸºçº¿æµ‹è¯•ï¼ˆå¿…é¡»é€šè¿‡ï¼‰**:
```bash
# æ ¹æ® .agent/commands.json ä¸­çš„é…ç½®æ‰§è¡Œ
typecheck â†’ lint â†’ build
```

**éªŒæ”¶æµ‹è¯•**:
```bash
bash scripts/run-acceptance.sh <task_id>
```

- å¤±è´¥æ—¶é‡è¯•æœ€å¤š 2 æ¬¡
- ä»å¤±è´¥ â†’ æ ‡è®°é˜»å¡

### Step 5: è®°å½•

è¿½åŠ åˆ° `progress.txt`ï¼Œæ ¼å¼è§ `templates/progress.md.template`

### Step 6: æäº¤

```bash
# 1. æ›´æ–° task.json: passes: false â†’ true
# 2. æ›´æ–° progress.txt
# 3. åŸå­æäº¤
git add . && git commit -m "[task title] - completed"
```

---

## é˜»å¡åè®®

**é‡åˆ°æ— æ³•å®Œæˆçš„ä»»åŠ¡æ—¶ï¼Œå¿…é¡»éµå®ˆï¼š**

| ç±»å‹ | è‡ªåŠ¨å¤„ç† | éœ€è¦äººå·¥ |
|------|---------|---------|
| ç¼ºä¾èµ– | å®‰è£… | å®‰è£…å¤±è´¥ |
| ç¼º API Key | å¦ | æ˜¯ |
| å¤–éƒ¨æœåŠ¡ | ç­‰å¾…é‡è¯• | è¶…æ—¶ |
| æŠ€æœ¯éš¾ç‚¹ | å¦ | æ˜¯ |

### ç¦æ­¢ (DO NOT)

- âŒ æäº¤ git commit
- âŒ è®¾ç½® `passes: true`
- âŒ ä½¿ç”¨æ¨¡æ‹Ÿ/è™šå‡æ•°æ®

### å¿…é¡» (DO)

- âœ… æ›´æ–° `task.json`ï¼š
  ```json
  {
    "blocked": true,
    "blocked_reason": "å…·ä½“åŸå› "
  }
  ```
- âœ… è®°å½•åˆ° `progress.txt`
- âœ… è¾“å‡ºé˜»å¡ä¿¡æ¯å¹¶åœæ­¢

### é˜»å¡ä¿¡æ¯æ ¼å¼

```
ğŸš« ä»»åŠ¡é˜»å¡ - éœ€è¦äººå·¥ä»‹å…¥

**ä»»åŠ¡**: [title] (id: [id])
**å·²å®Œæˆ**: [å…·ä½“å†…å®¹]
**åŸå› **: [ä¸ºä»€ä¹ˆæ— æ³•ç»§ç»­]
**éœ€è¦**: 1. [æ­¥éª¤1] 2. [æ­¥éª¤2]
```

---

## æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | Schema |
|------|------|--------|
| `task.json` | ä»»åŠ¡å®šä¹‰ | `schemas/task.schema.json` |
| `.agent/commands.json` | æ„å»ºå‘½ä»¤ | init-project.sh ç”Ÿæˆ |
| `.agent/checkpoint.json` | æ–­ç‚¹è®°å½• | è‡ªåŠ¨ç»´æŠ¤ |
| `progress.txt` | è¿›åº¦æ—¥å¿— | `templates/progress.md.template` |

---

## è„šæœ¬å‘½ä»¤

```bash
# åˆå§‹åŒ–é¡¹ç›®
bash scripts/init-project.sh

# éªŒè¯ç¯å¢ƒ
bash scripts/validate-env.sh

# æ‰§è¡ŒéªŒæ”¶
bash scripts/run-acceptance.sh <task_id>

# åˆ†æä»»åŠ¡
python3 scripts/task-analyzer.py
```

---

## æ ¸å¿ƒè§„åˆ™

1. **æ¯ session ä¸€ä¸ªä»»åŠ¡** â€” ä¸“æ³¨å®Œæˆ
2. **æµ‹è¯•åæ ‡è®°å®Œæˆ** â€” steps å…¨éƒ¨éªŒè¯
3. **é‡åº¦ä¿®æ”¹ç¯å¢ƒæµ‹è¯•** â€” æ–°é¡µé¢/æ ¸å¿ƒäº¤äº’å¿…é¡»åœ¨æµè§ˆå™¨éªŒè¯
4. **è®°å½• progress** â€” å¸®åŠ©åç»­ agent
5. **åŸå­æäº¤** â€” ä»£ç  + progress.txt + task.json åŒä¸€ commit
6. **ä¸å¯åˆ é™¤ä»»åŠ¡** â€” åªèƒ½ passes: false â†’ true
7. **é˜»å¡æ—¶åœæ­¢** â€” ä¸æäº¤ã€ä¸ä¼ªé€ 
8. **ä¸ç”¨å‡æ•°æ®** â€” ç¦æ­¢ç»•è¿‡éªŒè¯
9. **å°Šé‡ä¾èµ–** â€” depends_on æœªå®Œæˆä¸å¯å¼€å§‹

---

## å¿«é€Ÿå‚è€ƒ

```
å·¥ä½œæµ: init â†’ validate â†’ select â†’ implement â†’ verify â†’ record â†’ commit

çŠ¶æ€æµè½¬:
  â—‹ pending â†’ â— in_progress â†’ âœ“ completed
                       â†˜ âš  blocked

å…³é”®æ–‡ä»¶:
  task.json      ä»»åŠ¡å®šä¹‰ï¼ˆå”¯ä¸€çœŸç›¸æºï¼‰
  progress.txt   è¿›åº¦æ—¥å¿—
  .agent/        è¿è¡Œæ—¶çŠ¶æ€
```
